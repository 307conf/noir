{{ define "main" }}
<div class="max-w-4xl mx-auto px-4 py-12">
    <h1 class="text-4xl md:text-5xl font-bold mb-6 text-text-primary-light dark:text-text-primary-dark">{{ .Title }}</h1>
    {{ with .Content }}
        <div class="prose prose-invert mb-10">{{ . }}</div>
    {{ end }}

    {{ $presentations := where (where .Site.RegularPages "Section" "presentations") "Language.Lang" .Language.Lang }}
    {{ $entries := sort $presentations "Date" "asc" }}
    {{ if $entries }}
    <div class="space-y-6">
        {{ range $entries }}
        {{ $speakerName := (or .Params.speaker_name (.Param "speaker") "Unknown Speaker") }}
        {{ $speakerLink := .Params.speaker_link }}
        
        <!-- Try to find author page from authors field -->
        {{ $primaryAuthor := "" }}
        {{ with .Params.authors }}
            {{ if gt (len .) 0 }}
                {{ $primaryAuthor = index . 0 }}
            {{ end }}
        {{ end }}
        
        <!-- Search for author page using multiple path strategies -->
        {{ if $primaryAuthor }}
            {{ $authorPage := $.Site.GetPage (printf "%s/authors/%s" $.Language.Lang $primaryAuthor) }}
            {{ if not $authorPage }}
                {{ $authorPage = $.Site.GetPage (printf "authors/%s" $primaryAuthor) }}
            {{ end }}
            {{ if not $authorPage }}
                {{ $authorPage = $.Site.GetPage (printf "%s/authors/%s.md" $.Language.Lang $primaryAuthor) }}
            {{ end }}
            {{ with $authorPage }}
                {{ $speakerName = .Title }}
                {{ $speakerLink = .RelPermalink }}
            {{ end }}
        {{ end }}
        <article class="relative pl-8 before:content-[''] before:absolute before:left-0 before:top-0 before:w-[2px] before:h-full before:bg-gray-700 before:rounded-full">
            <div class="absolute -left-1.5 top-0 w-2 h-2 bg-gray-700 rounded-full"></div>
            <div class="text-gray-400 text-lg mb-1">
                {{ if $speakerLink }}
                    <a href="{{ $speakerLink }}" class="group inline-flex items-center gap-2 font-medium hover:text-accent-light dark:hover:text-accent-dark transition-colors duration-200">
                        {{ $speakerName }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity duration-200"><path d="M7 17l9.2-9.2M17 17V7H7"/></svg>
                    </a>
                {{ else }}
                    {{ $speakerName }}
                {{ end }}
            </div>
            <h2 class="text-2xl font-semibold">{{ .Title }}</h2>
            <div class="mt-2 text-text-primary-light dark:text-text-primary-dark">
                {{ .Summary }}
            </div>
            <span class="inline-flex items-center gap-2 py-2 pr-4">
                <!-- location/pin icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="opacity-90" width="20" height="20" viewBox="-7 -2 24 24"><path fill="currentColor" d="M4 9.9A5.002 5.002 0 0 1 5 0a5 5 0 0 1 1 9.9V19a1 1 0 0 1-2 0V9.9zM5 8a3 3 0 1 0 0-6a3 3 0 0 0 0 6z"/></svg>
                <p class="text-gray-400 text-md">{{ with .Params.location }}{{ . }}{{ end }}</p>
            </span>
            <span class="inline-flex items-center gap-2 py-2">
             <!-- calendar/period icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="opacity-90">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" fill="none"></rect>
                            <path d="M16 2v4M8 2v4" stroke="currentColor"></path>
                            <path d="M3 10h18" stroke="currentColor"></path>
                            <path d="M8 14h4v4" stroke="currentColor"></path>
                        </svg>
            <p class="text-gray-400 text-md">{{ with .Params.period }}{{ partial "format_datetime.html" (dict "date" . "format" "datetime") }}{{ else }}{{ partial "format_datetime.html" (dict "date" .Date "format" "datetime") }}{{ end }}</p>
            </span>
            <div>
            <a href="{{ .RelPermalink }}" class="inline-flex items-center text-sm text-blue-400 hover:text-blue-300 mt-3">{{ T "learnMore" }}<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><path d="M7 17l9.2-9.2M17 17V7H7"/></svg></a>
            </div>
        </article>
        {{ end }}
    </div>
    {{ else }}
        <p class="text-text-secondary-light dark:text-text-secondary-dark">{{ T "noEntriesYet" | default "Entries coming soon." }}</p>
    {{ end }}
</div>
{{ end }}
