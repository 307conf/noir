{{ define "main" }}
{{ if .Params.track }}
<div class="max-w-6xl mx-auto px-4 py-12">
    <div class="flex flex-col gap-6 mb-8">
        <div class="flex items-start gap-4">
            <div class="flex h-20 w-20 shrink-0 items-center justify-center rounded-xl border border-border-secondary-light dark:border-border-secondary-dark bg-bg-secondary-light dark:bg-bg-secondary-dark overflow-hidden">
                {{ with .Params.logo }}
                    <img src="{{ . }}" alt="{{ $.Title }} logo" class="h-full w-full object-cover">
                {{ else }}
                    <span class="text-xl font-semibold text-text-primary-light dark:text-text-primary-dark">{{ substr $.Title 0 1 }}</span>
                {{ end }}
            </div>
            <div class="space-y-1">
                <h1 class="text-4xl md:text-5xl font-bold text-text-primary-light dark:text-text-primary-dark">{{ .Title }}</h1>
                <div class="flex items-center gap-2 text-sm text-text-secondary-light dark:text-text-secondary-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-80" viewBox="-7 -2 24 24"><path fill="currentColor" d="M4 9.9A5.002 5.002 0 0 1 5 0a5 5 0 0 1 1 9.9V19a1 1 0 0 1-2 0V9.9zM5 8a3 3 0 1 0 0-6a3 3 0 0 0 0 6z"/></svg>
                    {{ with .Params.location }}<span>{{ . }}</span>{{ end }}
                </div>
            </div>
        </div>
        {{ with .Content }}
            <div class="prose prose-invert">{{ . }}</div>
        {{ end }}
    </div>

    {{ $allowedTracks := slice .Params.track }}
    {{ $presentations := where (where .Site.RegularPages "Section" "presentations") "Language.Lang" .Language.Lang }}
    {{ $filtered := partial "filter-presentations-by-tracks.html" (dict "Pages" $presentations "Tracks" $allowedTracks) }}
    {{ $entries := sort $filtered "Date" "asc" }}
    {{ $timeFormat := or .Params.datetime_format (and .Parent .Parent.Params.datetime_format) | default "HH:mm" }}

    {{ partial "presentation-table.html" (dict "Pages" $entries "ShowTracks" false "ShowLocation" false "Site" .Site "Language" .Language "TimeFormat" $timeFormat) }}
</div>
{{ else }}
<div class="max-w-6xl mx-auto px-4 py-12">
    <h1 class="text-4xl md:text-5xl font-bold mb-6 text-text-primary-light dark:text-text-primary-dark">{{ .Title }}</h1>
    {{ with .Content }}
        <div class="prose prose-invert mb-10">{{ . }}</div>
    {{ end }}

    {{ $villages := sort .Pages "Weight" "asc" }}
    {{ if $villages }}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {{ range $villages }}
            {{ partial "card-village.html" . }}
        {{ end }}
    </div>
    {{ else }}
        <p class="text-text-secondary-light dark:text-text-secondary-dark">{{ T "noEntriesYet" }}</p>
    {{ end }}
</div>
{{ end }}
{{ end }}
